import*as a from"https://unpkg.com/three/build/three.module.js";import{OrbitControls as Q}from"https://unpkg.com/three/examples/jsm/controls/OrbitControls.js";import{GLTFLoader as I}from"https://unpkg.com/three/examples/jsm/loaders/GLTFLoader.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const p of s)if(p.type==="childList")for(const w of p.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&i(w)}).observe(document,{childList:!0,subtree:!0});function d(s){const p={};return s.integrity&&(p.integrity=s.integrity),s.referrerPolicy&&(p.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?p.credentials="include":s.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function i(s){if(s.ep)return;s.ep=!0;const p=d(s);fetch(s.href,p)}})();function U({scene:t,camera:e,controls:d,renderer:i,keys:s},p,w){document.body.style.backgroundColor="black";const m=document.createElement("h1");m.innerHTML='<span style="color: #ADD8E6; text-shadow: 0 0 10px #ADD8E6, 0 0 20px #ADD8E6;">Robo</span> <span style="color: white; text-shadow: 0 0 10px #ADD8E6, 0 0 20px #ADD8E6;"></span> <span style="color: #FF4500; text-shadow: 0 0 10px #FF4500, 0 0 20px #FF4500;"> Run</span>',m.style.cssText=`
        text-align: center;
        position: absolute;
        top: 20%;
        left: 50%;
        transform: translateX(-50%);
        font-size: 6em;
        font-family: Arial, sans-serif;
    `,document.body.appendChild(m);let h=null;function g(x,S){if(h&&h.button===S){document.body.removeChild(h.popup),h=null;return}h&&document.body.removeChild(h.popup);const z=document.createElement("div");z.style.cssText=`
            position: fixed;
            top: 50%;
            right: 10%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            color: white;
            text-align: left;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            z-index: 1001;
            font-size: 1.2em;
            font-family: Arial, sans-serif;
        `,z.innerHTML=x,document.body.appendChild(z),h={popup:z,button:S}}function o(x,S,z){const c=document.createElement("button");return c.innerText=x,c.style.cssText=`
            position: absolute;
            top: ${S};
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            padding: 15px 30px;
            cursor: pointer;
            color: white;
            background: none;
            border: none;
            font-family: Arial, sans-serif;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
            transition: color 0.3s, text-shadow 0.3s;
        `,c.addEventListener("mouseover",()=>{c.style.color="#ff4500",c.style.textShadow="0 0 10px #ff4500"}),c.addEventListener("mouseout",()=>{c.style.color="white",c.style.textShadow="0 0 5px rgba(255, 255, 255, 0.5)"}),c.addEventListener("click",()=>z(c)),c}const y=o("Play Level 1","45%",()=>{E(),p({scene:t,camera:e,controls:d,renderer:i,keys:s})});document.body.appendChild(y);const b=o("Play Level 2","55%",()=>{E(),w({scene:t,camera:e,controls:d,renderer:i,keys:s})});document.body.appendChild(b);const k=o("Controls","65%",x=>{g("<h2>Game Controls: </h2><p>W-A-S-D to move <br> Space to Jump <br> C to toggle camera view </p>",x)});document.body.appendChild(k);const L=o("Objectives","75%",x=>{g("<h2>Objectives</h2><p>Finish the parkour and touch the yellow box at the end! <br><br> Level 1 (Ice): Be careful not to slip on the ice! <br> <br> Level 2 (Fire): Be careful of the lava, you dont wanna melt!</p>",x)});document.body.appendChild(L);function E(){document.body.removeChild(y),document.body.removeChild(b),document.body.removeChild(k),document.body.removeChild(L),document.body.removeChild(m),h&&document.body.removeChild(h.popup)}}const X=t=>{window.addEventListener("keydown",e=>{e.code==="KeyC"&&t()})},V=(t,e,d,i,s)=>{if(t){const p=s.position.clone().add(d);e.position.lerp(p,.05),e.lookAt(s.position.x,s.position.y,s.position.z)}else e.position.y=s.position.y+i.y,e.position.z=s.position.z+i.z,e.position.x=i.x,e.lookAt(0,s.position.y,s.position.z)},q=(t,e)=>{const d=new a.TextureLoader,i=e.map(w=>new a.MeshBasicMaterial({map:d.load(w),side:a.BackSide})),s=new a.BoxGeometry(1e3,1e3,1e3),p=new a.Mesh(s,i);return t.add(p),p};class n extends a.Mesh{constructor({width:e,height:d,depth:i,color:s="white",velocity:p={x:0,y:0,z:0},position:w={x:0,y:0,z:0},texture:m=null,wireframe:h=!1}){const g=new a.BoxGeometry(e,d,i);let o;m?o=new a.MeshStandardMaterial({map:m}):o=new a.MeshStandardMaterial({color:s}),h&&(o.wireframe=!0),super(g,o),this.width=e,this.height=d,this.depth=i,this.position.set(w.x,w.y,w.z),this.right=this.position.x+this.width/2,this.left=this.position.x-this.width/2,this.bottom=this.position.y-this.height/2,this.top=this.position.y+this.height/2,this.front=this.position.z+this.depth/2,this.back=this.position.z-this.depth/2,this.velocity=p,this.gravity=-.005,this.updateSides()}updateSides(){this.bottom=this.position.y-this.height/2,this.top=this.position.y+this.height/2,this.right=this.position.x+this.width/2,this.left=this.position.x-this.width/2,this.front=this.position.z+this.depth/2,this.back=this.position.z-this.depth/2}update(e){this.updateSides(),this.applyXZmovement(e),this.applyYmovement(e)}applyYmovement(e){let d=e.find(i=>tt(this,i)&&this.bottom<=i.top);d?(this.velocity.y=Math.max(this.velocity.y,0),this.position.y=d.top+this.height/2):this.velocity.y+=this.gravity,this.position.y+=this.velocity.y}applyXZmovement(e){for(let d of e){let i=et(this,d);i.onSameLevel&&i.withinZBounds&&(i.onLeft&&this.velocity.x>0?this.velocity.x=0:i.onRight&&this.velocity.x<0&&(this.velocity.x=0)),i.onSameLevel&&i.withinXBounds&&(i.onBack&&this.velocity.z>0?this.velocity.z=0:i.onFront&&this.velocity.z<0&&(this.velocity.z=0))}this.position.x+=this.velocity.x,this.position.z+=this.velocity.z}}function _(t,e){const d=t.right>=e.left&&t.left<=e.right,i=t.bottom<=e.top&&t.top>=e.bottom,s=t.front>=e.back&&t.back<=e.front;return d&&i&&s}function tt(t,e){const i=t.bottom<=e.top&&t.bottom>=e.top-.2,s=t.right>=e.left&&t.left<=e.right&&t.front>=e.back&&t.back<=e.front;return i&&s}function et(t,e){const d=t.bottom>=e.top,i=t.top>e.bottom&&t.bottom<e.top&&!d,s=t.right>e.left&&t.left<e.right,p=t.front>e.back&&t.back<e.front,w=t.right>=e.left&&t.left<e.left,m=t.left<=e.right&&t.right>e.right,h=t.back<=e.front&&t.front>e.front,g=t.front>=e.back&&t.back<e.back;return{onSameLevel:i,withinXBounds:s,withinZBounds:p,onLeft:w,onRight:m,onFront:h,onBack:g}}function Y(t,e,d){d==1?(t.velocity.x*=.96,t.velocity.z*=.96):d==2&&(t.velocity.x=0,t.velocity.z=0),e.w.pressed&&(t.velocity.z=-.1),e.s.pressed&&(t.velocity.z=.1),e.a.pressed&&(t.velocity.x=-.1),e.d.pressed&&(t.velocity.x=.1),e.space.pressed&&t.velocity.y==0&&(t.velocity.y=.12)}let O=!1,G=!1;function H(t){if(O)return;O=!0;const e=$("rgba(0, 0, 0, 0.2)"),d=K("Game Over","white","4em"),i=N("Respawn","#FF4500",t);e.appendChild(d),e.appendChild(i),document.body.appendChild(e)}function Z(t){if(G)return;G=!0;const e=$("rgba(0, 0, 0, 0.8)"),d=K("You Win!","#FFD700","5em"),i=K("(Refresh the webpage to try a different level)","#FFD700","1em"),s=N("Restart","#4CAF50",()=>{location.reload()});e.appendChild(d),e.appendChild(i),e.appendChild(s),document.body.appendChild(e)}function $(t){const e=document.createElement("div");return it(e,t),e}function it(t,e){t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor=e,t.style.display="flex",t.style.flexDirection="column",t.style.justifyContent="center",t.style.alignItems="center",t.style.zIndex="1000",t.style.fontFamily="Arial, sans-serif",t.style.animation="fadeIn 1s"}function K(t,e,d){const i=document.createElement("div");return i.innerHTML=t,i.style.color=e,i.style.fontSize=d,i.style.marginBottom="20px",i}function N(t,e,d){const i=document.createElement("button");return i.innerHTML=t,i.style.fontSize="2em",i.style.padding="10px 20px",i.style.cursor="pointer",i.style.color="white",i.style.backgroundColor=e,i.style.border="none",i.style.borderRadius="5px",i.addEventListener("click",()=>{d(),document.body.removeChild(i.parentElement),O=!1,G=!1}),i}let u,P=null,R=!0;function ot({scene:t,camera:e,controls:d,renderer:i,keys:s}){t.background=new a.Color(0);const p=new a.Vector3(0,6,8),w=new a.Vector3(0,20,0);X(()=>{R=!R}),q(t,["../../assets/skyboxes/blizzard_ft.jpg","../../assets/skyboxes/blizzard_bk.jpg","../../assets/skyboxes/blizzard_up.jpg","../../assets/skyboxes/blizzard_dn.jpg","../../assets/skyboxes/blizzard_rt.jpg","../../assets/skyboxes/blizzard_lf.jpg"]),u=new n({width:2,height:1,depth:1,position:{x:0,y:0,z:1},velocity:{x:0,y:0,z:0},color:"cyan",wireframe:!0}),u.material.opacity=0,u.material.transparent=!0,t.add(u);const m=new I;let h;m.load("../../assets/models/robot.glb",r=>{h=r.scene,h.castShadow=!0,h.traverse(f=>{if(f.isMesh){f.castShadow=!0;const F=f.material;f.material=new a.MeshStandardMaterial({map:F.map,color:F.color,metalness:F.metalness,roughness:F.roughness})}}),h.rotation.y=Math.PI,h.scale.set(.5,.5,.5),h.position.set(u.position.x,u.position.y,u.position.z),t.add(h)},void 0,r=>{console.error(r)});const g=new a.TextureLoader,o=g.load("../../assets/textures/ice_texture.png",void 0,void 0,r=>{console.error("Error loading texture:",r)});o.wrapS=a.RepeatWrapping,o.wrapT=a.RepeatWrapping,o.repeat.set(2,2);const y=g.load("../../assets/textures/ice_texture.png",void 0,void 0,r=>{console.error("Error loading texture:",r)});y.wrapS=a.RepeatWrapping,y.wrapT=a.RepeatWrapping,y.repeat.set(5,.5);const b=g.load("../../assets/textures/ice_texture.png",void 0,void 0,r=>{console.error("Error loading texture:",r)});b.wrapS=a.RepeatWrapping,b.wrapT=a.RepeatWrapping,b.repeat.set(.5,2.5);const k=[new n({width:4,height:.5,depth:8,position:{x:0,y:-2,z:-2},texture:o}),new n({width:4,height:.5,depth:4,position:{x:0,y:-2,z:-10},texture:o}),new n({width:3,height:.5,depth:3,position:{x:-3,y:-1,z:-16},texture:o}),new n({width:20,height:.5,depth:2,position:{x:5,y:-2,z:-22},texture:y}),new n({width:3,height:.5,depth:3,position:{x:15,y:-2,z:-28},texture:o}),new n({width:3,height:.5,depth:3,position:{x:10,y:-3,z:-33},texture:o}),new n({width:3,height:.5,depth:3,position:{x:3,y:-2,z:-33},texture:o}),new n({width:3,height:.5,depth:3,position:{x:0,y:-1,z:-39},texture:o}),new n({width:2,height:.5,depth:10,position:{x:0,y:0,z:-49},texture:b}),new n({width:3,height:.5,depth:3,position:{x:-2,y:-1,z:-57},texture:o}),new n({width:3,height:.5,depth:3,position:{x:-3,y:0,z:-63},texture:o}),new n({width:3,height:.5,depth:3,position:{x:-1,y:0,z:-69},texture:o}),new n({width:3,height:.5,depth:3,position:{x:0,y:0,z:-76},texture:o}),new n({width:5,height:.5,depth:5,position:{x:0,y:0,z:-84},texture:o})];k.forEach(r=>{r.receiveShadow=!0,t.add(r)});const L=new n({width:1,height:1,depth:1,position:{x:0,y:0,z:-85},color:"yellow"});L.castShadow=!0,t.add(L);const E=new a.AmbientLight(11393254,1);t.add(E);const x=new a.DirectionalLight(16777215,1);x.position.set(0,3,2),x.castShadow=!0,t.add(x);const S=new a.HemisphereLight(0,16777215);t.add(S);const z=1/60;let c=0,T=0;function A(r=0){P=requestAnimationFrame(A),r*=.001;const f=r-T;for(T=r,c+=f;c>=z;)Y(u,s,1),u.update(k),j(),c-=z;h&&h.position.set(u.position.x,u.position.y,u.position.z),V(R,e,p,w,u),i.render(t,e),d.update()}function j(){u.position.y<-35&&(cancelAnimationFrame(P),H(B)),_(u,L)&&(cancelAnimationFrame(P),Z())}function B(){u.position.set(0,0,1),u.velocity.x=0,u.velocity.y=0,u.velocity.z=0,A()}A()}let l,D=null,W=!0;function nt({scene:t,camera:e,controls:d,renderer:i,keys:s}){t.background=new a.Color(0);const p=new a.Vector3(0,6,8),w=new a.Vector3(0,20,0);X(()=>{W=!W}),q(t,["../../assets/skyboxes/cocoa_ft.jpg","../../assets/skyboxes/cocoa_bk.jpg","../../assets/skyboxes/cocoa_up.jpg","../../assets/skyboxes/cocoa_dn.jpg","../../assets/skyboxes/cocoa_rt.jpg","../../assets/skyboxes/cocoa_lf.jpg"]),l=new n({width:2,height:1,depth:1,position:{x:0,y:0,z:1},velocity:{x:0,y:0,z:0},color:"cyan",wireframe:!0}),l.material.opacity=0,l.material.transparent=!0,t.add(l);const m=new I;let h;m.load("../../assets/models/robot.glb",r=>{h=r.scene,h.castShadow=!0,h.traverse(f=>{if(f.isMesh){f.castShadow=!0;const F=f.material;f.material=new a.MeshStandardMaterial({map:F.map,color:F.color,metalness:F.metalness,roughness:F.roughness})}}),h.rotation.y=Math.PI,h.scale.set(.5,.5,.5),h.position.set(l.position.x,l.position.y,l.position.z),t.add(h)},void 0,r=>{console.error(r)});const g=new a.TextureLoader,o=g.load("../assets/textures/cobble_texture.png"),y=g.load("../../assets/textures/lava_texture.jpg");o.wrapS=a.RepeatWrapping,o.wrapT=a.RepeatWrapping,o.repeat.set(1,1);const b=[new n({width:5,height:.5,depth:7,position:{x:0,y:-2,z:0},texture:o}),new n({width:5,height:.5,depth:5,position:{x:0,y:-1,z:-7},texture:o}),new n({width:8,height:.5,depth:8,position:{x:-10,y:0,z:-11},texture:o}),new n({width:5,height:.5,depth:5,position:{x:-7,y:-1,z:-20},texture:o}),new n({width:6,height:.5,depth:6,position:{x:0,y:-2,z:-20},texture:o}),new n({width:3,height:.5,depth:3,position:{x:3,y:-4,z:-29},texture:o}),new n({width:5,height:.5,depth:5,position:{x:9,y:-3,z:-34},texture:o}),new n({width:3,height:.5,depth:3,position:{x:5,y:-2,z:-40},texture:o}),new n({width:2,height:.5,depth:2,position:{x:0,y:-2,z:-40},texture:o}),new n({width:2,height:.5,depth:2,position:{x:0,y:-2,z:-43},texture:o}),new n({width:2,height:.5,depth:2,position:{x:0,y:-2,z:-46},texture:o}),new n({width:2,height:.5,depth:2,position:{x:0,y:-2,z:-49},texture:o}),new n({width:2,height:.5,depth:2,position:{x:0,y:-2,z:-52},texture:o}),new n({width:2,height:.5,depth:2,position:{x:0,y:-2,z:-55},texture:o}),new n({width:2,height:.5,depth:2,position:{x:0,y:-2,z:-58},texture:o}),new n({width:2,height:.5,depth:2,position:{x:0,y:-2,z:-61},texture:o}),new n({width:2,height:.5,depth:2,position:{x:0,y:-2,z:-64},texture:o}),new n({width:2,height:.5,depth:2,position:{x:0,y:-2,z:-67},texture:o}),new n({width:2,height:.5,depth:2,position:{x:0,y:-2,z:-70},texture:o})];b.forEach(r=>{r.receiveShadow=!0,t.add(r)});const k=new n({width:1,height:1,depth:1,position:{x:0,y:-2,z:-70},color:"yellow"});k.castShadow=!0,t.add(k);const L=new a.AmbientLight(16777215,.2);t.add(L);const E=new a.HemisphereLight(0,16753920,3);t.add(E);const x=[new n({width:2,height:.2,depth:2,position:{x:1.5,y:-1.84,z:-2.5},texture:y}),new n({width:5,height:.2,depth:5,position:{x:-9,y:.16,z:-12},texture:y}),new n({width:3,height:.2,depth:3,position:{x:1.5,y:-1.84,z:-21.5},texture:y}),new n({width:3,height:.2,depth:3,position:{x:1.5,y:-1.84,z:-18.5},texture:y}),new n({width:1.8,height:.2,depth:1.8,position:{x:0,y:-1.84,z:-43},texture:y}),new n({width:1.8,height:.2,depth:1.8,position:{x:0,y:-1.84,z:-49},texture:y}),new n({width:1.8,height:.2,depth:1.8,position:{x:0,y:-1.84,z:-55},texture:y}),new n({width:1.8,height:.2,depth:1.8,position:{x:0,y:-1.84,z:-61},texture:y}),new n({width:1.8,height:.2,depth:1.8,position:{x:0,y:-1.84,z:-67},texture:y}),new n({width:3,height:.2,depth:3,position:{x:9,y:-2.84,z:-34},texture:y})];x.forEach(r=>{t.add(r)}),[{color:16753920,intensity:15,distance:400,position:{x:1.5,y:-1,z:-2.5}},{color:16753920,intensity:25,distance:400,position:{x:-9,y:1,z:-12}},{color:16753920,intensity:25,distance:400,position:{x:1.5,y:-1,z:-21.5}},{color:16753920,intensity:20,distance:400,position:{x:1.5,y:-1,z:-18.5}},{color:16753920,intensity:15,distance:400,position:{x:0,y:-1,z:-43}},{color:16753920,intensity:15,distance:400,position:{x:0,y:-1,z:-49}},{color:16753920,intensity:15,distance:400,position:{x:0,y:-1,z:-55}},{color:16753920,intensity:15,distance:400,position:{x:0,y:-1,z:-61}},{color:16753920,intensity:15,distance:400,position:{x:0,y:-1,z:-67}},{color:16753920,intensity:25,distance:400,position:{x:9,y:-2,z:-34}}].forEach(r=>{const f=new a.PointLight(r.color,r.intensity,r.distance);f.position.set(r.position.x,r.position.y,r.position.z),t.add(f)});const z=1/60;let c=0,T=0;function A(r=0){D=requestAnimationFrame(A),r*=.001;const f=r-T;for(T=r,c+=f;c>=z;)Y(l,s,2),l.update(b),j(),c-=z;h&&h.position.set(l.position.x,l.position.y,l.position.z),V(W,e,p,w,l),i.render(t,e),d.update()}function j(){l.position.y<-35&&(cancelAnimationFrame(D),H(B)),x.forEach(r=>{_(l,r)&&(cancelAnimationFrame(D),H(B))}),_(l,k)&&(cancelAnimationFrame(D),Z())}function B(){l.position.set(0,0,0),l.velocity.x=0,l.velocity.y=0,l.velocity.z=0,A()}A()}const v={w:{pressed:!1},a:{pressed:!1},s:{pressed:!1},d:{pressed:!1},space:{pressed:!1}};function st(){window.addEventListener("keydown",t=>{switch(t.code){case"KeyW":v.w.pressed=!0;break;case"KeyA":v.a.pressed=!0;break;case"KeyS":v.s.pressed=!0;break;case"KeyD":v.d.pressed=!0;break;case"Space":v.space.pressed=!0;break}}),window.addEventListener("keyup",t=>{switch(t.code){case"KeyW":v.w.pressed=!1;break;case"KeyA":v.a.pressed=!1;break;case"KeyS":v.s.pressed=!1;break;case"KeyD":v.d.pressed=!1;break;case"Space":v.space.pressed=!1;break}})}const J=new a.Scene;J.background=new a.Color(0);const M=new a.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);M.position.z=5;const C=new a.WebGLRenderer({antialias:!0});C.localClippingEnabled=!1;C.shadowMap.enabled=!0;C.shadowMap.type=a.PCFSoftShadowMap;C.setSize(window.innerWidth,window.innerHeight);document.body.appendChild(C.domElement);const rt=new Q(M,C.domElement);window.addEventListener("resize",()=>{const t=window.innerWidth,e=window.innerHeight;C.setSize(t,e),M.aspect=t/e,M.updateProjectionMatrix()});U({scene:J,camera:M,controls:rt,renderer:C,keys:v},ot,nt);st();
